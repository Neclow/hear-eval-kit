#Define all the requirements for running end to end
test_folder=./test_root_folder
module=hearbaseline
model_root=https://github.com/neuralaudio/hear-baseline/raw/main/saved_models
model_file_name=naive_baseline.pt
version=test0.1
task_version=speech_commands-v0.0.2-small

#Define the directories to use for the process
luigi_dir=$test_folder/test_luigi
tasks_dir=$test_folder/test_tasks
embeddings_dir=$test_folder/test_embeddings
echo Luigi Dir is $luigi_dir
echo Tasks Dir is $tasks_dir
echo Embeddings Dir is $embeddings_dir

#Run the task runner for preprocessing the data.
#Small is passed as this is a testing script
#all is passed here. One version
python -m heareval.tasks.runner all --small \
    --luigi-dir $luigi_dir --tasks-dir $tasks_dir

#Downlaod the model
model_path=$test_folder/$model_file_name
rm -f $model_path
wget $model_root/$model_file_name -P $test_folder

#Run the embeddings runner for generating embeddings for the preprocessed data
#Version is specific to a model and helps is creating embeddings for different
#version of the model. 
#Task_version is the versioned task name which is used to generate the embeddings
python3 -m heareval.embeddings.runner $module \
    --model $model_path --version $version \
    --tasks-dir $tasks_dir --task-version $task_version \
    --embeddings-dir $embeddings_dir

#Run the predictions runner to for generating the predictions
python3 -m heareval.predictions.runner $module \
    --model $model_path --version $version \
    --embeddings-dir $embeddings_dir

#Run the evaluation runner for evaluating the embeddings generated by the version of 
#the model. The module-version corresponds folder name of the embeddings_dir to 
#evaluate on
python3 -m heareval.evaluation.runner \
    --embeddings-dir $embeddings_dir --embedding-version $module-$version